<!-- AI Analysis Dashboard Component -->
{% if result.ai_analysis and result.ai_analysis.dashboard_format %}
<div class="bg-gradient-to-br from-purple-900/20 to-blue-900/20 rounded-lg border border-purple-500/30 p-6 mb-6">
    <div class="flex items-center space-x-3 mb-6">
        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
            üß†
        </div>
        <div>
            <h3 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">
                Dashboard-Ready Format
            </h3>
            <p class="text-sm text-gray-400">Analyzed by {{ result.ai_analysis.analyzer_model }}</p>
        </div>
        {% if result.ai_analysis.confidence_score %}
        <div class="ml-auto text-right">
            <div class="text-2xl font-bold text-green-400">{{ (result.ai_analysis.confidence_score * 100)|round }}%</div>
            <div class="text-xs text-gray-400">Confidence</div>
        </div>
        {% endif %}
    </div>

    <!-- 1. Overview Section -->
    <div class="mb-6">
        <h4 class="text-lg font-semibold text-yellow-400 mb-3">1. Overview</h4>
        <div class="space-y-2 text-sm">
            <div><span class="text-gray-400">Task:</span> <span class="text-white">{{ result.ai_analysis.dashboard_format.overview.task }}</span></div>
            <div><span class="text-gray-400">Status:</span> 
                <span class="{% if 'Success' in result.ai_analysis.dashboard_format.overview.status %}text-green-400{% elif 'Partial' in result.ai_analysis.dashboard_format.overview.status %}text-yellow-400{% else %}text-red-400{% endif %}">
                    {{ result.ai_analysis.dashboard_format.overview.status }}
                </span>
                ‚Äî {{ result.ai_analysis.dashboard_format.overview.status_reason }}
            </div>
            <div><span class="text-gray-400">Execution:</span> <span class="text-white">{{ result.ai_analysis.dashboard_format.overview.execution }}</span></div>
        </div>
    </div>

    <!-- 2. Performance Metrics Section -->
    <div class="mb-6">
        <h4 class="text-lg font-semibold text-yellow-400 mb-3">2. Performance Metrics</h4>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-gray-600">
                        <th class="text-left py-2 text-gray-400">Metric</th>
                        <th class="text-right py-2 text-gray-400">Value</th>
                        <th class="text-center py-2 text-gray-400">üìã</th>
                    </tr>
                </thead>
                <tbody>
                    {% for metric in result.ai_analysis.dashboard_format.performance_metrics %}
                    <tr class="border-b border-gray-700/50">
                        <td class="py-2 text-gray-300">{{ metric.metric }}</td>
                        <td class="py-2 text-right text-white font-medium">{{ metric.value }}</td>
                        <td class="py-2 text-center">
                            <button class="text-gray-400 hover:text-white" onclick="copyToClipboard('{{ metric.value }}')">üìã</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- 3. Actionable Insights Section -->
    <div class="mb-6">
        <h4 class="text-lg font-semibold text-yellow-400 mb-3">3. Actionable Insights</h4>
        <div class="space-y-3">
            <div>
                <span class="text-green-400 font-medium">Strength:</span>
                <span class="text-gray-300">{{ result.ai_analysis.dashboard_format.actionable_insights.strength }}</span>
            </div>
            <div>
                <span class="text-red-400 font-medium">Weakness:</span>
                <span class="text-gray-300">{{ result.ai_analysis.dashboard_format.actionable_insights.weakness }}</span>
            </div>
            <div>
                <span class="text-blue-400 font-medium">Recommendation:</span>
                <span class="text-gray-300">{{ result.ai_analysis.dashboard_format.actionable_insights.recommendation }}</span>
            </div>
        </div>
    </div>

    <!-- JavaScript for copy functionality -->
    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Simple notification
                const notification = document.createElement('div');
                notification.textContent = 'Copied!';
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-3 py-1 rounded text-sm z-50';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
            });
        }
    </script>
</div>

<!-- Legacy Analysis (Hidden by default) -->
<details class="bg-dark-card border border-dark-border rounded-lg p-4 mt-4">
    <summary class="text-gray-400 cursor-pointer hover:text-white">Show Raw Analysis</summary>
    {% if result.ai_analysis.structured_insights.overview %}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-black/20 rounded-lg p-4 border border-gray-700">
            <div class="text-sm text-gray-400">Status</div>
            <div class="text-lg font-semibold {% if result.execution_summary.overall_success %}text-green-400{% else %}text-red-400{% endif %}">
                {% if result.execution_summary.overall_success %}‚úÖ Success{% else %}‚ùå Failed{% endif %}
            </div>
        </div>
        <div class="bg-black/20 rounded-lg p-4 border border-gray-700">
            <div class="text-sm text-gray-400">AI Score</div>
            <div class="text-lg font-semibold text-purple-400">{{ result.ai_analysis.structured_insights.overview.score }}/10</div>
        </div>
        <div class="bg-black/20 rounded-lg p-4 border border-gray-700">
            <div class="text-sm text-gray-400">Screenshots</div>
            <div class="text-lg font-semibold text-blue-400">{{ result.ai_analysis.screenshots_analyzed }}</div>
        </div>
        <div class="bg-black/20 rounded-lg p-4 border border-gray-700">
            <div class="text-sm text-gray-400">Duration</div>
            <div class="text-lg font-semibold text-yellow-400">{{ result.test_metadata.total_duration_seconds }}s</div>
        </div>
    </div>
    {% endif %}

    <!-- Detailed Analysis Sections -->
    <div class="space-y-6">
        
        <!-- Strengths -->
        {% if result.ai_analysis.structured_insights.strengths %}
        <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
            <h4 class="text-green-400 font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                Strengths Identified
            </h4>
            <ul class="space-y-2">
                {% for strength in result.ai_analysis.structured_insights.strengths %}
                <li class="text-green-100 flex items-start">
                    <span class="text-green-400 mr-2">‚Ä¢</span>
                    {{ strength }}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Weaknesses -->
        {% if result.ai_analysis.structured_insights.weaknesses %}
        <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4">
            <h4 class="text-red-400 font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Areas for Improvement
            </h4>
            <ul class="space-y-2">
                {% for weakness in result.ai_analysis.structured_insights.weaknesses %}
                <li class="text-red-100 flex items-start">
                    <span class="text-red-400 mr-2">‚Ä¢</span>
                    {{ weakness }}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Recommendations -->
        {% if result.ai_analysis.structured_insights.recommendations %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% if result.ai_analysis.structured_insights.recommendations.website %}
            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                <h4 class="text-blue-400 font-semibold mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    Website Improvements
                </h4>
                <ul class="space-y-2">
                    {% for rec in result.ai_analysis.structured_insights.recommendations.website %}
                    <li class="text-blue-100 flex items-start">
                        <span class="text-blue-400 mr-2">‚Üí</span>
                        {{ rec }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if result.ai_analysis.structured_insights.recommendations.automation %}
            <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4">
                <h4 class="text-purple-400 font-semibold mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                    </svg>
                    Automation Improvements
                </h4>
                <ul class="space-y-2">
                    {% for rec in result.ai_analysis.structured_insights.recommendations.automation %}
                    <li class="text-purple-100 flex items-start">
                        <span class="text-purple-400 mr-2">‚Üí</span>
                        {{ rec }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Raw Analysis (Collapsible) -->
    <div class="mt-6 border-t border-gray-700 pt-6">
        <button onclick="toggleRawAnalysis()" class="flex items-center text-gray-400 hover:text-gray-200 transition-colors">
            <svg id="rawAnalysisIcon" class="w-4 h-4 mr-2 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
            View Full AI Analysis
        </button>
        <div id="rawAnalysisContent" class="hidden mt-4 bg-black/30 rounded-lg p-4 border border-gray-700">
            <pre class="text-sm text-gray-300 whitespace-pre-wrap font-mono">{{ result.ai_analysis.raw_analysis }}</pre>
        </div>
    </div>
</div>

<script>
function toggleRawAnalysis() {
    const content = document.getElementById('rawAnalysisContent');
    const icon = document.getElementById('rawAnalysisIcon');
    
    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        icon.style.transform = 'rotate(180deg)';
    } else {
        content.classList.add('hidden');
        icon.style.transform = 'rotate(0deg)';
    }
}
</script>

{% else %}
<!-- Fallback when no AI analysis available -->
<div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-6">
    <div class="flex items-center">
        <svg class="w-5 h-5 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        <span class="text-yellow-200">AI Analysis not available - using basic metrics</span>
    </div>
</div>
{% endif %}
